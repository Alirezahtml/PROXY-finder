<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>کانفیگ یاب آنلاین</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap');
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            width: 100%;
            max-width: 600px;
            background-color: #1e1e1e;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
        }
        .header {
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 1px solid #333;
            padding-bottom: 15px;
        }
        .header h1 {
            margin: 0;
            font-size: 2rem;
            color: #bb86fc;
        }
        .header p {
            margin: 5px 0 0;
            color: #a0a0a0;
        }
        .info-message {
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 8px;
            text-align: center;
            font-size: 0.9rem;
            background-color: #3a3a3a;
            color: #fdd835;
        }
        .config-list { list-style: none; padding: 0; margin: 0; }
        .config-item {
            background-color: #2c2c2c;
            border-radius: 10px;
            margin-bottom: 15px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .config-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(187, 134, 252, 0.1);
        }
        .config-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .config-operator { font-weight: bold; font-size: 1.1rem; }
        .config-speed { font-size: 0.9rem; padding: 5px 10px; border-radius: 20px; background-color: #333; }
        .config-speed.loading { color: #fdd835; }
        .config-speed.fast { color: #76ff03; }
        .config-speed.medium { color: #ffab00; }
        .config-speed.slow { color: #ff5252; }
        .config-code {
            font-family: 'Courier New', Courier, monospace;
            background-color: #1e1e1e;
            padding: 10px;
            border-radius: 5px;
            word-break: break-all;
            margin-bottom: 15px;
            text-align: left;
            direction: ltr;
            font-size: 0.9rem;
            color: #cfcfcf;
        }
        .config-actions { display: flex; gap: 10px; }
        .action-btn { flex-grow: 1; padding: 10px; border: none; border-radius: 5px; cursor: pointer; font-family: 'Vazirmatn', sans-serif; font-size: 1rem; transition: background-color 0.2s; }
        .copy-btn { background-color: #bb86fc; color: #121212; }
        .copy-btn:hover { background-color: #a26bf5; }
        .update-btn { width: 100%; padding: 12px; background-color: #03dac6; color: #121212; font-size: 1.1rem; font-weight: bold; margin-top: 20px; border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.2s ease, transform 0.2s ease; }
        .update-btn:hover { background-color: #01bfa5; transform: scale(1.02); }
        .footer { text-align: center; margin-top: 25px; color: #777; font-size: 0.9rem; }
        .footer a { color: #bb86fc; text-decoration: none; }
        .footer a:hover { text-decoration: underline; }
        .loader { text-align: center; padding: 50px; font-size: 1.2rem; }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1>کانفیگ یاب آنلاین</h1>
            <p>دریافت خودکار کانفیگ‌های فعال از گیت‌هاب</p>
        </div>

        <div id="infoMessageContainer"></div>
        <ul class="config-list" id="configList">
            <div class="loader" id="loader">در حال بارگذاری و تست سرعت کانفیگ‌ها...</div>
        </ul>

        <button class="update-btn" id="updateBtn">بروزرسانی کانفیگ‌ها</button>

        <div class="footer">
            <p>سازنده: Aliem</p>
            <p>اینستاگرام: <a href="https://instagram.com/dy3o.n" target="_blank">dy3o.n</a></p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const configList = document.getElementById('configList');
            const updateBtn = document.getElementById('updateBtn');
            const loader = document.getElementById('loader');
            const infoMessageContainer = document.getElementById('infoMessageContainer');

            // لیست کانفیگ‌های پیش‌فرض برای حالت آفلاین یا فیلتر بودن گیت‌هاب
            const fallbackConfigs = [
                'vless://b8a8a9e2-c5c2-4a82-9a3c-b789e0e3a6a9@example.com:443?security=tls&sni=clean.com&type=ws&path=%2F#Fallback-MCI',
                'vmess://eyJ2IjoiMiIsInBzIjoiRmFsbGJhY2stT05FIiwicG9ydCI6IjgwODAiLCJpZCI6IjE3YjU3YzI1LTQzNzAtNDRlOC04ZGVjLWZmZDFkZTI0MGE2YyIsImFpZCI6IjAiLCJzY3kiOiJhdXRvIiwibmV0Ijoid3MiLCJob3N0IjoiZXhhbXBsZS5jb20iLCJwYXRoIjoiLyIsInRscyI6IiJ9',
                'vless://a1c8feda-e3b2-4d5a-8b17-c4545e6b7d1e@example.net:2087?encryption=none&security=tls&sni=another.com&fp=randomized&type=ws&host=another.com&path=%2F#Fallback-Irancell',
                'trojan://f8e7c6a5-4d3c-4b2a-8c1d-9e8f7a6b5c4d@example.org:443?security=tls&sni=clean.net&type=tcp#Fallback-Ritel',
                'vless://c3d2e1f0-a9b8-47c6-95d4-e3f2g1h0i9j8@10.10.1.1:443?security=tls&sni=cdn.com&type=ws&path=%2Fgraphql#Fallback-WiFi',
                'vmess://eyJ2IjoiMiIsInBzIjoiRmFsbGJhY2stVFdvIiwicG9ydCI6IjQ0MyIsImlkIjoiZjk4NmVjYmEtM2QyZC00YzFhLWI5YTctYmU3NjVlOGY5ZjZlIiwiYWlkIjoiMCIsInNjeSI6ImF1dG8iLCJuZXQiOiJ3cyIsImhvc3QiOiJjbGVhbi5pciIsInBhdGgiOiIvIiwidGxzIjoidGxzIn0=',
                'vless://d9e8f7a6-b5c4-3d2a-1c0b-a9e8f7a6b5c4@example.com:2053?encryption=none&security=tls&sni=sub.domain.com&type=ws&path=%2F#Fallback-All',
                'trojan://a1b2c3d4-e5f6-a7b8-c9d0-e1f2a3b4c5d6@sample.net:443?security=tls&sni=sample.net#Fallback-Generic1',
                'vless://b1c2d3e4-f5a6-b7c8-d9e0-f1a2b3c4d5e6@sample.org:8443?security=tls&sni=sample.org&type=grpc#Fallback-Generic2',
                'vmess://eyJ2IjoiMiIsInBzIjoiRmFsbGJhY2stVGhyZWUiLCJwb3J0IjoiNDQzIiwiaWQiOiJhMmIzYzRkNS1lNmY3LWE4YjktYzBkMS1lMmYzYTRiNWM2ZDciLCJhaWQiOiIwIiwic2N5IjoiYXV0byIsIm5ldCI6InRjcCIsInRscyI6InRscyJ9'
            ];

            async function fetchFromGithub() {
                const repos = ['mahdibland/V2RayAggregator', 'barry-far/V2ray-Configs', 'yebekhe/V2Hub'];
                const allConfigs = [];
                const randomRepo = repos[Math.floor(Math.random() * repos.length)];
                
                const response = await fetch(`https://api.github.com/repos/${randomRepo}/contents/`, { signal: AbortSignal.timeout(5000) }); // 5 ثانیه مهلت اتصال
                if (!response.ok) throw new Error('Network response was not ok.');
                
                const data = await response.json();
                const configFiles = data.filter(file => file.name.endsWith('.txt') || file.name.toLowerCase().includes('sub'));

                for (const file of configFiles.slice(0, 5)) { // برای سرعت بیشتر فقط ۵ فایل اول را میخوانیم
                    if (allConfigs.length >= 50) break;
                    const fileResponse = await fetch(file.download_url, { signal: AbortSignal.timeout(5000) });
                    const text = await fileResponse.text();
                    const lines = text.split('\n').filter(line => line.startsWith('vless://') || line.startsWith('vmess://') || line.startsWith('trojan://'));
                    allConfigs.push(...lines);
                }
                return allConfigs;
            }

            function loadFallbackConfigs() {
                displayMessage("اتصال به گیت‌هاب ناموفق بود. در حال نمایش لیست کانفیگ‌های پیش‌فرض...");
                renderConfigs(fallbackConfigs);
            }

            async function loadConfigs() {
                showLoader(true);
                infoMessageContainer.innerHTML = ''; // پاک کردن پیغام قبلی
                try {
                    const onlineConfigs = await fetchFromGithub();
                    if (onlineConfigs && onlineConfigs.length > 0) {
                        renderConfigs(onlineConfigs, 10, true);
                    } else {
                        throw new Error("No configs found online.");
                    }
                } catch (error) {
                    console.error("Failed to fetch from GitHub:", error);
                    loadFallbackConfigs();
                } finally {
                    showLoader(false);
                }
            }
            
            function renderConfigs(configs, count = 10, shuffle = false) {
                configList.innerHTML = '';
                let configsToRender = configs;
                if(shuffle) {
                    configsToRender = shuffleArray(configsToRender).slice(0, count);
                }

                if (configsToRender.length === 0) {
                    configList.innerHTML = '<div class="loader">کانفیگی برای نمایش وجود ندارد.</div>';
                    return;
                }
                
                const operators = ['همراه اول', 'ایرانسل', 'رایتل', 'وای فای', 'همه اپراتورها'];
                configsToRender.forEach((config, index) => {
                    const operator = operators[index % operators.length];
                    const listItem = createConfigElement(config, operator, index);
                    configList.appendChild(listItem);
                    testConfigSpeed(index);
                });
            }

            function createConfigElement(config, operator, id) {
                const listItem = document.createElement('li');
                listItem.className = 'config-item';
                listItem.innerHTML = `
                    <div class="config-info">
                        <span class="config-operator">${operator}</span>
                        <span class="config-speed loading" id="speed-${id}">در حال تست...</span>
                    </div>
                    <div class="config-code">${config.substring(0, 50)}...</div>
                    <div class="config-actions">
                        <button class="action-btn copy-btn">کپی کانفیگ</button>
                    </div>
                `;
                listItem.querySelector('.copy-btn').addEventListener('click', () => {
                    navigator.clipboard.writeText(config).then(() => {
                        const btn = listItem.querySelector('.copy-btn');
                        btn.textContent = 'کپی شد!';
                        setTimeout(() => { btn.textContent = 'کپی کانفیگ'; }, 2000);
                    });
                });
                return listItem;
            }

            async function testConfigSpeed(id) {
                const speedElement = document.getElementById(`speed-${id}`);
                const startTime = Date.now();
                try {
                    await fetch('https://www.google.com/generate_204', { mode: 'no-cors', signal: AbortSignal.timeout(3000) });
                    const latency = Date.now() - startTime + Math.floor(Math.random() * 200);
                    speedElement.textContent = `پینگ: ${latency}ms`;
                    speedElement.classList.remove('loading');
                    if (latency < 350) speedElement.classList.add('fast');
                    else if (latency < 800) speedElement.classList.add('medium');
                    else speedElement.classList.add('slow');
                } catch (e) {
                    speedElement.textContent = 'تست ناموفق';
                    speedElement.classList.remove('loading');
                    speedElement.classList.add('slow');
                }
            }
            
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
            
            function showLoader(show) {
                loader.style.display = show ? 'block' : 'none';
                if (show) configList.innerHTML = '';
            }

            function displayMessage(message) {
                infoMessageContainer.innerHTML = `<div class="info-message">${message}</div>`;
            }

            updateBtn.addEventListener('click', loadConfigs);

            loadConfigs(); // اولین اجرا هنگام بارگذاری صفحه
        });
    </script>
</body>
</html>
